{"format_version":"1.2","terraform_version":"1.11.3","variables":{"allocated_storage":{"value":20},"asg_max_size":{"value":2},"availability_zones":{"value":["eu-west-1a","eu-west-1b"]},"db_engine":{"value":"mysql"},"db_instance_class":{"value":"db.t3.micro"},"db_password":{"value":"YourSecurePassword123!"},"db_username":{"value":"admin"},"dr_region":{"value":"us-east-1"},"enable_encryption":{"value":true},"engine_version":{"value":"8.0"},"environment_name":{"value":"primary"},"expiration_days":{"value":365},"glacier_days":{"value":180},"ia_days":{"value":90},"instance_type":{"value":"t3.micro"},"key_pair_name":{"value":"nebula-key"},"multi_az":{"value":false},"primary_region":{"value":"eu-west-1"},"private_subnets":{"value":["10.0.3.0/24","10.0.4.0/24"]},"project_name":{"value":"nebula"},"public_subnets":{"value":["10.0.1.0/24","10.0.2.0/24"]},"tags":{"value":{"Environment":"primary","Project":"nebula"}},"vpc_cidr":{"value":"10.0.0.0/16"}},"planned_values":{"outputs":{"database_config_parameter_name":{"sensitive":false,"type":"string","value":"/nebula/primary/database"}},"root_module":{"child_modules":[{"resources":[{"address":"module.ec2.aws_ami_copy.dr_ami[0]","mode":"managed","type":"aws_ami_copy","name":"dr_ami","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"deprecation_time":null,"description":"DR copy of primary instance AMI","destination_outpost_arn":null,"encrypted":true,"source_ami_region":"eu-west-1","tags":{"DR":"true","Environment":"primary-dr","Name":"nebula-dr-ami","Project":"nebula","Region":"us-east-1"},"tags_all":{"DR":"true","Environment":"primary-dr","Name":"nebula-dr-ami","Project":"nebula","Region":"us-east-1","Terraform":"true"},"timeouts":null},"sensitive_values":{"ebs_block_device":[],"ephemeral_block_device":[],"tags":{},"tags_all":{}}},{"address":"module.ec2.aws_ami_from_instance.primary_ami[0]","mode":"managed","type":"aws_ami_from_instance","name":"primary_ami","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"deprecation_time":null,"description":"Daily AMI backup of primary instance for DR purposes","snapshot_without_reboot":null,"tags":{"Environment":"primary","Name":"nebula-primary-ami","Project":"nebula","Region":"eu-west-1"},"tags_all":{"Environment":"primary","Name":"nebula-primary-ami","Project":"nebula","Region":"eu-west-1","Terraform":"true"},"timeouts":null},"sensitive_values":{"ebs_block_device":[],"ephemeral_block_device":[],"tags":{},"tags_all":{}}},{"address":"module.ec2.aws_cloudwatch_event_rule.daily_ami[0]","mode":"managed","type":"aws_cloudwatch_event_rule","name":"daily_ami","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Trigger daily AMI creation","event_bus_name":"default","event_pattern":null,"is_enabled":true,"name":"nebula-primary-daily-ami","role_arn":null,"schedule_expression":"cron(0 1 * * ? *)","tags":{"Environment":"primary","Name":"nebula-daily-ami-rule","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-daily-ami-rule","Project":"nebula","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.ec2.aws_cloudwatch_event_target.ssm_automation[0]","mode":"managed","type":"aws_cloudwatch_event_target","name":"ssm_automation","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"arn":"arn:aws:ssm:eu-west-1:202533544511:automation-definition/nebula-primary-daily-ami-backup","batch_target":[],"dead_letter_config":[],"ecs_target":[],"event_bus_name":"default","http_target":[],"input_path":null,"input_transformer":[],"kinesis_target":[],"redshift_target":[],"retry_policy":[],"rule":"nebula-primary-daily-ami","run_command_targets":[],"sqs_target":[],"target_id":"SSMAutomation"},"sensitive_values":{"batch_target":[],"dead_letter_config":[],"ecs_target":[],"http_target":[],"input_transformer":[],"kinesis_target":[],"redshift_target":[],"retry_policy":[],"run_command_targets":[],"sqs_target":[]}},{"address":"module.ec2.aws_iam_instance_profile.ec2_profile","mode":"managed","type":"aws_iam_instance_profile","name":"ec2_profile","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"nebula-primary-ec2-profile","path":"/","role":"nebula-primary-ec2-role","tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"sensitive_values":{"tags_all":{}}},{"address":"module.ec2.aws_iam_role.ec2_role","mode":"managed","type":"aws_iam_role","name":"ec2_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"nebula-primary-ec2-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"role_last_used":[],"tags_all":{}}},{"address":"module.ec2.aws_iam_role.eventbridge_role[0]","mode":"managed","type":"aws_iam_role","name":"eventbridge_role","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"events.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"nebula-primary-eventbridge-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"role_last_used":[],"tags_all":{}}},{"address":"module.ec2.aws_iam_role_policy.ami_policy","mode":"managed","type":"aws_iam_role_policy","name":"ami_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"nebula-primary-ami-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"ec2:CreateImage\",\"ec2:CreateTags\",\"ec2:CopyImage\",\"ec2:DescribeImages\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}]}"},"sensitive_values":{}},{"address":"module.ec2.aws_iam_role_policy.cloudwatch_policy","mode":"managed","type":"aws_iam_role_policy","name":"cloudwatch_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"nebula-primary-cloudwatch-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"cloudwatch:PutMetricData\",\"ec2:DescribeVolumes\",\"ec2:DescribeTags\",\"logs:PutLogEvents\",\"logs:DescribeLogStreams\",\"logs:DescribeLogGroups\",\"logs:CreateLogStream\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}]}"},"sensitive_values":{}},{"address":"module.ec2.aws_iam_role_policy.eventbridge_policy[0]","mode":"managed","type":"aws_iam_role_policy","name":"eventbridge_policy","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"nebula-primary-eventbridge-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"ssm:StartAutomationExecution\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:ssm:eu-west-1:202533544511:automation-definition/nebula-primary-daily-ami-backup:*\"]}]}"},"sensitive_values":{}},{"address":"module.ec2.aws_iam_role_policy.ssm_policy","mode":"managed","type":"aws_iam_role_policy","name":"ssm_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"nebula-primary-ssm-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"ssm:GetParameter\",\"ssm:GetParameters\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:ssm:eu-west-1:202533544511:parameter/nebula/primary/*\"]}]}"},"sensitive_values":{}},{"address":"module.ec2.aws_instance.nebula_primary_instance[0]","mode":"managed","type":"aws_instance","name":"nebula_primary_instance","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"ami":"ami-01c7096235204c7be","credit_specification":[],"get_password_data":false,"hibernation":null,"iam_instance_profile":"nebula-primary-ec2-profile","instance_type":"t3.micro","key_name":"nebula-key","launch_template":[],"source_dest_check":true,"tags":{"Environment":"primary","Name":"nebula-primary-ec2","Project":"nebula","Region":"eu-west-1"},"tags_all":{"Environment":"primary","Name":"nebula-primary-ec2","Project":"nebula","Region":"eu-west-1","Terraform":"true"},"timeouts":null,"user_data":"327e1dfc89575d501740b515aaf7fd2587668a08","user_data_replace_on_change":false,"volume_tags":null},"sensitive_values":{"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"ebs_block_device":[],"enclave_options":[],"ephemeral_block_device":[],"ipv6_addresses":[],"launch_template":[],"maintenance_options":[],"metadata_options":[],"network_interface":[],"private_dns_name_options":[],"root_block_device":[],"secondary_private_ips":[],"security_groups":[],"tags":{},"tags_all":{},"user_data":true,"vpc_security_group_ids":[]}},{"address":"module.ec2.aws_security_group.ec2_sg","mode":"managed","type":"aws_security_group","name":"ec2_sg","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Security group for EC2 instances","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTP access","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80},{"cidr_blocks":["0.0.0.0/0"],"description":"Allow SSH access","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22}],"name":"nebula-primary-ec2-sg","revoke_rules_on_delete":false,"tags":{"Environment":"primary","Name":"nebula-primary-ec2-sg","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-ec2-sg","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}},{"address":"module.ec2.aws_ssm_document.create_ami","mode":"managed","type":"aws_ssm_document","name":"create_ami","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"attachments_source":[],"content":"schemaVersion: '0.3'\ndescription: 'Create AMI from EC2 instance and copy to DR region'\nparameters:\n  InstanceId:\n    type: String\n    description: ID of the EC2 instance\n  AMIName:\n    type: String\n    description: Name prefix for the AMI\n  SourceRegion:\n    type: String\n    description: Source region\n  DestinationRegion:\n    type: String\n    description: Destination region for AMI copy\nmainSteps:\n  - name: createImage\n    action: 'aws:createImage'\n    inputs:\n      InstanceId: '{{ InstanceId }}'\n      ImageName: '{{ AMIName }}-{{global:DATE_TIME}}'\n      NoReboot: true\n      TagSpecifications:\n        - ResourceType: image\n          Tags:\n            - Key: Name\n              Value: '{{ AMIName }}'\n            - Key: Environment\n              Value: primary\n            - Key: Project\n              Value: nebula\n    outputs:\n      - Name: ImageId\n        Selector: '$.ImageId'\n        Type: String\n  - name: copyImage\n    action: 'aws:copyImage'\n    inputs:\n      SourceImageId: '{{ createImage.ImageId }}'\n      SourceRegion: '{{ SourceRegion }}'\n      DestinationRegion: '{{ DestinationRegion }}'\n      ImageName: '{{ AMIName }}-dr-{{global:DATE_TIME}}'\n      Encrypted: true\n","document_format":"YAML","document_type":"Automation","name":"nebula-primary-daily-ami-backup","permissions":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"},"target_type":null,"version_name":null},"sensitive_values":{"attachments_source":[],"parameter":[],"platform_types":[],"tags_all":{}}}],"address":"module.ec2"},{"resources":[{"address":"module.rds.aws_db_instance.nebula_primary_db_instance[0]","mode":"managed","type":"aws_db_instance","name":"nebula_primary_db_instance","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"allocated_storage":20,"allow_major_version_upgrade":null,"apply_immediately":false,"auto_minor_version_upgrade":true,"blue_green_update":[],"copy_tags_to_snapshot":false,"custom_iam_instance_profile":null,"customer_owned_ip_enabled":null,"db_subnet_group_name":"dr-db-subnet-group-primary","delete_automated_backups":true,"deletion_protection":null,"domain":null,"domain_iam_role_name":null,"enabled_cloudwatch_logs_exports":null,"engine":"mysql","engine_version":"8.0","final_snapshot_identifier":null,"iam_database_authentication_enabled":null,"identifier":"nebula-primary","instance_class":"db.t3.micro","manage_master_user_password":null,"max_allocated_storage":null,"monitoring_interval":0,"multi_az":false,"password":"YourSecurePassword123!","performance_insights_enabled":false,"publicly_accessible":false,"replicate_source_db":null,"restore_to_point_in_time":[],"s3_import":[],"security_group_names":null,"skip_final_snapshot":true,"storage_encrypted":true,"tags":{"Environment":"primary","Name":"nebula-primary-db","Project":"nebula","Region":"eu-west-1"},"tags_all":{"Environment":"primary","Name":"nebula-primary-db","Project":"nebula","Region":"eu-west-1","Terraform":"true"},"timeouts":null,"username":"admin"},"sensitive_values":{"blue_green_update":[],"listener_endpoint":[],"master_user_secret":[],"password":true,"replicas":[],"restore_to_point_in_time":[],"s3_import":[],"tags":{},"tags_all":{},"vpc_security_group_ids":[]}},{"address":"module.rds.aws_db_subnet_group.nebula_subnet_group","mode":"managed","type":"aws_db_subnet_group","name":"nebula_subnet_group","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Subnet group for RDS in primary environment","name":"dr-db-subnet-group-primary","tags":{"Environment":"primary","Name":"dr-db-subnet-group-primary"},"tags_all":{"Environment":"primary","Name":"dr-db-subnet-group-primary","Project":"nebula","Terraform":"true"}},"sensitive_values":{"subnet_ids":[],"supported_network_types":[],"tags":{},"tags_all":{}}},{"address":"module.rds.aws_security_group.rds_sg","mode":"managed","type":"aws_security_group","name":"rds_sg","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Security group for RDS instances","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":[],"description":"Allow MySQL access from EC2 instances","from_port":3306,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","self":false,"to_port":3306}],"name":"nebula-primary-rds-sg","revoke_rules_on_delete":false,"tags":{"Name":"nebula-primary-rds-sg"},"tags_all":{"Environment":"primary","Name":"nebula-primary-rds-sg","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}],"address":"module.rds"},{"resources":[{"address":"module.s3.aws_iam_policy.replication","mode":"managed","type":"aws_iam_policy","name":"replication","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":null,"name":"nebula-s3-replication-policy","path":"/","tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"sensitive_values":{"tags_all":{}}},{"address":"module.s3.aws_iam_role.replication","mode":"managed","type":"aws_iam_role","name":"replication","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"s3.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"nebula-s3-replication-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"role_last_used":[],"tags_all":{}}},{"address":"module.s3.aws_iam_role_policy_attachment.replication","mode":"managed","type":"aws_iam_role_policy_attachment","name":"replication","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"role":"nebula-s3-replication-role"},"sensitive_values":{}},{"address":"module.s3.aws_s3_bucket.nebula_dr_bucket","mode":"managed","type":"aws_s3_bucket","name":"nebula_dr_bucket","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"force_destroy":false,"tags":null,"tags_all":{"DR":"true","Environment":"primary-dr","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}},{"address":"module.s3.aws_s3_bucket.nebula_primary_bucket","mode":"managed","type":"aws_s3_bucket","name":"nebula_primary_bucket","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"force_destroy":false,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}},{"address":"module.s3.aws_s3_bucket_lifecycle_configuration.nebula_bucket_lifecycle","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"nebula_bucket_lifecycle","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":365}],"filter":[],"id":"archive_old_objects","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":null,"status":"Enabled","transition":[{"date":"","days":180,"storage_class":"GLACIER"},{"date":"","days":90,"storage_class":"STANDARD_IA"}]}]},"sensitive_values":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[{},{}]}]}},{"address":"module.s3.aws_s3_bucket_lifecycle_configuration.nebula_dr_bucket_lifecycle","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"nebula_dr_bucket_lifecycle","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":365}],"filter":[],"id":"archive_old_objects","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":null,"status":"Enabled","transition":[{"date":"","days":180,"storage_class":"GLACIER"},{"date":"","days":90,"storage_class":"STANDARD_IA"}]}]},"sensitive_values":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[{},{}]}]}},{"address":"module.s3.aws_s3_bucket_replication_configuration.nebula_crr","mode":"managed","type":"aws_s3_bucket_replication_configuration","name":"nebula_crr","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"rule":[{"delete_marker_replication":[],"destination":[{"access_control_translation":[],"account":null,"encryption_configuration":[],"metrics":[],"replication_time":[],"storage_class":"STANDARD"}],"existing_object_replication":[],"filter":[],"id":"full-bucket-replication","prefix":null,"priority":null,"source_selection_criteria":[],"status":"Enabled"}],"token":null},"sensitive_values":{"rule":[{"delete_marker_replication":[],"destination":[{"access_control_translation":[],"encryption_configuration":[],"metrics":[],"replication_time":[]}],"existing_object_replication":[],"filter":[],"source_selection_criteria":[]}],"token":true}},{"address":"module.s3.aws_s3_bucket_versioning.nebula_dr_version","mode":"managed","type":"aws_s3_bucket_versioning","name":"nebula_dr_version","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"sensitive_values":{"versioning_configuration":[{}]}},{"address":"module.s3.aws_s3_bucket_versioning.nebula_primary_version","mode":"managed","type":"aws_s3_bucket_versioning","name":"nebula_primary_version","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"sensitive_values":{"versioning_configuration":[{}]}},{"address":"module.s3.random_id.bucket_suffix","mode":"managed","type":"random_id","name":"bucket_suffix","provider_name":"registry.terraform.io/hashicorp/random","schema_version":0,"values":{"byte_length":4,"keepers":null,"prefix":null},"sensitive_values":{}}],"address":"module.s3"},{"resources":[{"address":"module.ssm.aws_ssm_parameter.database_config","mode":"managed","type":"aws_ssm_parameter","name":"database_config","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"allowed_pattern":null,"description":"Database configuration","name":"/nebula/primary/database","overwrite":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"},"type":"SecureString"},"sensitive_values":{"tags_all":{},"value":true}}],"address":"module.ssm"},{"resources":[{"address":"module.vpc.aws_internet_gateway.nebula_igw","mode":"managed","type":"aws_internet_gateway","name":"nebula_igw","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"Environment":"primary","Name":"nebula-primary-igw","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-igw","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_route_table.nebula_private_rt","mode":"managed","type":"aws_route_table","name":"nebula_private_rt","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"Environment":"primary","Name":"nebula-primary-private-rt","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-private-rt","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_route_table.nebula_public_rt","mode":"managed","type":"aws_route_table","name":"nebula_public_rt","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"route":[{"carrier_gateway_id":"","cidr_block":"0.0.0.0/0","core_network_arn":"","destination_prefix_list_id":"","egress_only_gateway_id":"","instance_id":"","ipv6_cidr_block":"","local_gateway_id":"","nat_gateway_id":"","network_interface_id":"","transit_gateway_id":"","vpc_endpoint_id":"","vpc_peering_connection_id":""}],"tags":{"Environment":"primary","Name":"nebula-primary-public-rt","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-public-rt","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[{}],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_route_table_association.nebula_private_rt_assoc[0]","mode":"managed","type":"aws_route_table_association","name":"nebula_private_rt_assoc","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.nebula_private_rt_assoc[1]","mode":"managed","type":"aws_route_table_association","name":"nebula_private_rt_assoc","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.nebula_public_rt_assoc[0]","mode":"managed","type":"aws_route_table_association","name":"nebula_public_rt_assoc","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.nebula_public_rt_assoc[1]","mode":"managed","type":"aws_route_table_association","name":"nebula_public_rt_assoc","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}},{"address":"module.vpc.aws_subnet.nebula_private_subnet[0]","mode":"managed","type":"aws_subnet","name":"nebula_private_subnet","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1a","cidr_block":"10.0.3.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-private-1","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-private-1","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.nebula_private_subnet[1]","mode":"managed","type":"aws_subnet","name":"nebula_private_subnet","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1b","cidr_block":"10.0.4.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-private-2","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-private-2","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.nebula_public_subnet[0]","mode":"managed","type":"aws_subnet","name":"nebula_public_subnet","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1a","cidr_block":"10.0.1.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-public-1","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-public-1","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.nebula_public_subnet[1]","mode":"managed","type":"aws_subnet","name":"nebula_public_subnet","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1b","cidr_block":"10.0.2.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-public-2","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-public-2","Project":"nebula","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_vpc.nebula_vpc","mode":"managed","type":"aws_vpc","name":"nebula_vpc","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_generated_ipv6_cidr_block":null,"cidr_block":"10.0.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","ipv4_ipam_pool_id":null,"ipv4_netmask_length":null,"ipv6_ipam_pool_id":null,"ipv6_netmask_length":null,"tags":{"Environment":"primary","Name":"nebula-primary-vpc","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-vpc","Project":"nebula","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}}],"address":"module.vpc"}]}},"resource_changes":[{"address":"module.ec2.aws_ami_copy.dr_ami[0]","module_address":"module.ec2","mode":"managed","type":"aws_ami_copy","name":"dr_ami","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"deprecation_time":null,"description":"DR copy of primary instance AMI","destination_outpost_arn":null,"encrypted":true,"source_ami_region":"eu-west-1","tags":{"DR":"true","Environment":"primary-dr","Name":"nebula-dr-ami","Project":"nebula","Region":"us-east-1"},"tags_all":{"DR":"true","Environment":"primary-dr","Name":"nebula-dr-ami","Project":"nebula","Region":"us-east-1","Terraform":"true"},"timeouts":null},"after_unknown":{"architecture":true,"arn":true,"boot_mode":true,"ebs_block_device":true,"ena_support":true,"ephemeral_block_device":true,"hypervisor":true,"id":true,"image_location":true,"image_owner_alias":true,"image_type":true,"imds_support":true,"kernel_id":true,"kms_key_id":true,"manage_ebs_snapshots":true,"name":true,"owner_id":true,"platform":true,"platform_details":true,"public":true,"ramdisk_id":true,"root_device_name":true,"root_snapshot_id":true,"source_ami_id":true,"sriov_net_support":true,"tags":{},"tags_all":{},"tpm_support":true,"usage_operation":true,"virtualization_type":true},"before_sensitive":false,"after_sensitive":{"ebs_block_device":[],"ephemeral_block_device":[],"tags":{},"tags_all":{}}}},{"address":"module.ec2.aws_ami_from_instance.primary_ami[0]","module_address":"module.ec2","mode":"managed","type":"aws_ami_from_instance","name":"primary_ami","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"deprecation_time":null,"description":"Daily AMI backup of primary instance for DR purposes","snapshot_without_reboot":null,"tags":{"Environment":"primary","Name":"nebula-primary-ami","Project":"nebula","Region":"eu-west-1"},"tags_all":{"Environment":"primary","Name":"nebula-primary-ami","Project":"nebula","Region":"eu-west-1","Terraform":"true"},"timeouts":null},"after_unknown":{"architecture":true,"arn":true,"boot_mode":true,"ebs_block_device":true,"ena_support":true,"ephemeral_block_device":true,"hypervisor":true,"id":true,"image_location":true,"image_owner_alias":true,"image_type":true,"imds_support":true,"kernel_id":true,"manage_ebs_snapshots":true,"name":true,"owner_id":true,"platform":true,"platform_details":true,"public":true,"ramdisk_id":true,"root_device_name":true,"root_snapshot_id":true,"source_instance_id":true,"sriov_net_support":true,"tags":{},"tags_all":{},"tpm_support":true,"usage_operation":true,"virtualization_type":true},"before_sensitive":false,"after_sensitive":{"ebs_block_device":[],"ephemeral_block_device":[],"tags":{},"tags_all":{}}}},{"address":"module.ec2.aws_cloudwatch_event_rule.daily_ami[0]","module_address":"module.ec2","mode":"managed","type":"aws_cloudwatch_event_rule","name":"daily_ami","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Trigger daily AMI creation","event_bus_name":"default","event_pattern":null,"is_enabled":true,"name":"nebula-primary-daily-ami","role_arn":null,"schedule_expression":"cron(0 1 * * ? *)","tags":{"Environment":"primary","Name":"nebula-daily-ami-rule","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-daily-ami-rule","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"name_prefix":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.ec2.aws_cloudwatch_event_target.ssm_automation[0]","module_address":"module.ec2","mode":"managed","type":"aws_cloudwatch_event_target","name":"ssm_automation","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"arn":"arn:aws:ssm:eu-west-1:202533544511:automation-definition/nebula-primary-daily-ami-backup","batch_target":[],"dead_letter_config":[],"ecs_target":[],"event_bus_name":"default","http_target":[],"input_path":null,"input_transformer":[],"kinesis_target":[],"redshift_target":[],"retry_policy":[],"rule":"nebula-primary-daily-ami","run_command_targets":[],"sqs_target":[],"target_id":"SSMAutomation"},"after_unknown":{"batch_target":[],"dead_letter_config":[],"ecs_target":[],"http_target":[],"id":true,"input":true,"input_transformer":[],"kinesis_target":[],"redshift_target":[],"retry_policy":[],"role_arn":true,"run_command_targets":[],"sqs_target":[]},"before_sensitive":false,"after_sensitive":{"batch_target":[],"dead_letter_config":[],"ecs_target":[],"http_target":[],"input_transformer":[],"kinesis_target":[],"redshift_target":[],"retry_policy":[],"run_command_targets":[],"sqs_target":[]}}},{"address":"module.ec2.aws_iam_instance_profile.ec2_profile","module_address":"module.ec2","mode":"managed","type":"aws_iam_instance_profile","name":"ec2_profile","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"nebula-primary-ec2-profile","path":"/","role":"nebula-primary-ec2-role","tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"name_prefix":true,"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"module.ec2.aws_iam_role.ec2_role","module_address":"module.ec2","mode":"managed","type":"aws_iam_role","name":"ec2_role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"nebula-primary-ec2-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"role_last_used":true,"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"role_last_used":[],"tags_all":{}}}},{"address":"module.ec2.aws_iam_role.eventbridge_role[0]","module_address":"module.ec2","mode":"managed","type":"aws_iam_role","name":"eventbridge_role","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"events.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"nebula-primary-eventbridge-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"role_last_used":true,"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"role_last_used":[],"tags_all":{}}}},{"address":"module.ec2.aws_iam_role_policy.ami_policy","module_address":"module.ec2","mode":"managed","type":"aws_iam_role_policy","name":"ami_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"nebula-primary-ami-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"ec2:CreateImage\",\"ec2:CreateTags\",\"ec2:CopyImage\",\"ec2:DescribeImages\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}]}"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ec2.aws_iam_role_policy.cloudwatch_policy","module_address":"module.ec2","mode":"managed","type":"aws_iam_role_policy","name":"cloudwatch_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"nebula-primary-cloudwatch-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"cloudwatch:PutMetricData\",\"ec2:DescribeVolumes\",\"ec2:DescribeTags\",\"logs:PutLogEvents\",\"logs:DescribeLogStreams\",\"logs:DescribeLogGroups\",\"logs:CreateLogStream\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}]}"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ec2.aws_iam_role_policy.eventbridge_policy[0]","module_address":"module.ec2","mode":"managed","type":"aws_iam_role_policy","name":"eventbridge_policy","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"nebula-primary-eventbridge-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"ssm:StartAutomationExecution\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:ssm:eu-west-1:202533544511:automation-definition/nebula-primary-daily-ami-backup:*\"]}]}"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ec2.aws_iam_role_policy.ssm_policy","module_address":"module.ec2","mode":"managed","type":"aws_iam_role_policy","name":"ssm_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"nebula-primary-ssm-policy","name_prefix":null,"policy":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"ssm:GetParameter\",\"ssm:GetParameters\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:ssm:eu-west-1:202533544511:parameter/nebula/primary/*\"]}]}"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ec2.aws_instance.nebula_primary_instance[0]","module_address":"module.ec2","mode":"managed","type":"aws_instance","name":"nebula_primary_instance","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"ami":"ami-01c7096235204c7be","credit_specification":[],"get_password_data":false,"hibernation":null,"iam_instance_profile":"nebula-primary-ec2-profile","instance_type":"t3.micro","key_name":"nebula-key","launch_template":[],"source_dest_check":true,"tags":{"Environment":"primary","Name":"nebula-primary-ec2","Project":"nebula","Region":"eu-west-1"},"tags_all":{"Environment":"primary","Name":"nebula-primary-ec2","Project":"nebula","Region":"eu-west-1","Terraform":"true"},"timeouts":null,"user_data":"327e1dfc89575d501740b515aaf7fd2587668a08","user_data_replace_on_change":false,"volume_tags":null},"after_unknown":{"arn":true,"associate_public_ip_address":true,"availability_zone":true,"capacity_reservation_specification":true,"cpu_core_count":true,"cpu_options":true,"cpu_threads_per_core":true,"credit_specification":[],"disable_api_stop":true,"disable_api_termination":true,"ebs_block_device":true,"ebs_optimized":true,"enclave_options":true,"ephemeral_block_device":true,"host_id":true,"host_resource_group_arn":true,"id":true,"instance_initiated_shutdown_behavior":true,"instance_state":true,"ipv6_address_count":true,"ipv6_addresses":true,"launch_template":[],"maintenance_options":true,"metadata_options":true,"monitoring":true,"network_interface":true,"outpost_arn":true,"password_data":true,"placement_group":true,"placement_partition_number":true,"primary_network_interface_id":true,"private_dns":true,"private_dns_name_options":true,"private_ip":true,"public_dns":true,"public_ip":true,"root_block_device":true,"secondary_private_ips":true,"security_groups":true,"subnet_id":true,"tags":{},"tags_all":{},"tenancy":true,"user_data_base64":true,"vpc_security_group_ids":true},"before_sensitive":false,"after_sensitive":{"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"ebs_block_device":[],"enclave_options":[],"ephemeral_block_device":[],"ipv6_addresses":[],"launch_template":[],"maintenance_options":[],"metadata_options":[],"network_interface":[],"private_dns_name_options":[],"root_block_device":[],"secondary_private_ips":[],"security_groups":[],"tags":{},"tags_all":{},"user_data":true,"vpc_security_group_ids":[]}}},{"address":"module.ec2.aws_security_group.ec2_sg","module_address":"module.ec2","mode":"managed","type":"aws_security_group","name":"ec2_sg","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Security group for EC2 instances","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTP access","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80},{"cidr_blocks":["0.0.0.0/0"],"description":"Allow SSH access","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22}],"name":"nebula-primary-ec2-sg","revoke_rules_on_delete":false,"tags":{"Environment":"primary","Name":"nebula-primary-ec2-sg","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-ec2-sg","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"name_prefix":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}},{"address":"module.ec2.aws_ssm_document.create_ami","module_address":"module.ec2","mode":"managed","type":"aws_ssm_document","name":"create_ami","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"attachments_source":[],"content":"schemaVersion: '0.3'\ndescription: 'Create AMI from EC2 instance and copy to DR region'\nparameters:\n  InstanceId:\n    type: String\n    description: ID of the EC2 instance\n  AMIName:\n    type: String\n    description: Name prefix for the AMI\n  SourceRegion:\n    type: String\n    description: Source region\n  DestinationRegion:\n    type: String\n    description: Destination region for AMI copy\nmainSteps:\n  - name: createImage\n    action: 'aws:createImage'\n    inputs:\n      InstanceId: '{{ InstanceId }}'\n      ImageName: '{{ AMIName }}-{{global:DATE_TIME}}'\n      NoReboot: true\n      TagSpecifications:\n        - ResourceType: image\n          Tags:\n            - Key: Name\n              Value: '{{ AMIName }}'\n            - Key: Environment\n              Value: primary\n            - Key: Project\n              Value: nebula\n    outputs:\n      - Name: ImageId\n        Selector: '$.ImageId'\n        Type: String\n  - name: copyImage\n    action: 'aws:copyImage'\n    inputs:\n      SourceImageId: '{{ createImage.ImageId }}'\n      SourceRegion: '{{ SourceRegion }}'\n      DestinationRegion: '{{ DestinationRegion }}'\n      ImageName: '{{ AMIName }}-dr-{{global:DATE_TIME}}'\n      Encrypted: true\n","document_format":"YAML","document_type":"Automation","name":"nebula-primary-daily-ami-backup","permissions":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"},"target_type":null,"version_name":null},"after_unknown":{"arn":true,"attachments_source":[],"created_date":true,"default_version":true,"description":true,"document_version":true,"hash":true,"hash_type":true,"id":true,"latest_version":true,"owner":true,"parameter":true,"platform_types":true,"schema_version":true,"status":true,"tags_all":{}},"before_sensitive":false,"after_sensitive":{"attachments_source":[],"parameter":[],"platform_types":[],"tags_all":{}}}},{"address":"module.rds.aws_db_instance.nebula_primary_db_instance[0]","module_address":"module.rds","mode":"managed","type":"aws_db_instance","name":"nebula_primary_db_instance","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"allocated_storage":20,"allow_major_version_upgrade":null,"apply_immediately":false,"auto_minor_version_upgrade":true,"blue_green_update":[],"copy_tags_to_snapshot":false,"custom_iam_instance_profile":null,"customer_owned_ip_enabled":null,"db_subnet_group_name":"dr-db-subnet-group-primary","delete_automated_backups":true,"deletion_protection":null,"domain":null,"domain_iam_role_name":null,"enabled_cloudwatch_logs_exports":null,"engine":"mysql","engine_version":"8.0","final_snapshot_identifier":null,"iam_database_authentication_enabled":null,"identifier":"nebula-primary","instance_class":"db.t3.micro","manage_master_user_password":null,"max_allocated_storage":null,"monitoring_interval":0,"multi_az":false,"password":"YourSecurePassword123!","performance_insights_enabled":false,"publicly_accessible":false,"replicate_source_db":null,"restore_to_point_in_time":[],"s3_import":[],"security_group_names":null,"skip_final_snapshot":true,"storage_encrypted":true,"tags":{"Environment":"primary","Name":"nebula-primary-db","Project":"nebula","Region":"eu-west-1"},"tags_all":{"Environment":"primary","Name":"nebula-primary-db","Project":"nebula","Region":"eu-west-1","Terraform":"true"},"timeouts":null,"username":"admin"},"after_unknown":{"address":true,"arn":true,"availability_zone":true,"backup_retention_period":true,"backup_window":true,"blue_green_update":[],"ca_cert_identifier":true,"character_set_name":true,"db_name":true,"endpoint":true,"engine_version_actual":true,"hosted_zone_id":true,"id":true,"identifier_prefix":true,"iops":true,"kms_key_id":true,"latest_restorable_time":true,"license_model":true,"listener_endpoint":true,"maintenance_window":true,"master_user_secret":true,"master_user_secret_kms_key_id":true,"monitoring_role_arn":true,"name":true,"nchar_character_set_name":true,"network_type":true,"option_group_name":true,"parameter_group_name":true,"performance_insights_kms_key_id":true,"performance_insights_retention_period":true,"port":true,"replica_mode":true,"replicas":true,"resource_id":true,"restore_to_point_in_time":[],"s3_import":[],"snapshot_identifier":true,"status":true,"storage_throughput":true,"storage_type":true,"tags":{},"tags_all":{},"timezone":true,"vpc_security_group_ids":true},"before_sensitive":false,"after_sensitive":{"blue_green_update":[],"listener_endpoint":[],"master_user_secret":[],"password":true,"replicas":[],"restore_to_point_in_time":[],"s3_import":[],"tags":{},"tags_all":{},"vpc_security_group_ids":[]}}},{"address":"module.rds.aws_db_subnet_group.nebula_subnet_group","module_address":"module.rds","mode":"managed","type":"aws_db_subnet_group","name":"nebula_subnet_group","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Subnet group for RDS in primary environment","name":"dr-db-subnet-group-primary","tags":{"Environment":"primary","Name":"dr-db-subnet-group-primary"},"tags_all":{"Environment":"primary","Name":"dr-db-subnet-group-primary","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"name_prefix":true,"subnet_ids":true,"supported_network_types":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"subnet_ids":[],"supported_network_types":[],"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_security_group.rds_sg","module_address":"module.rds","mode":"managed","type":"aws_security_group","name":"rds_sg","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Security group for RDS instances","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":[],"description":"Allow MySQL access from EC2 instances","from_port":3306,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","self":false,"to_port":3306}],"name":"nebula-primary-rds-sg","revoke_rules_on_delete":false,"tags":{"Name":"nebula-primary-rds-sg"},"tags_all":{"Environment":"primary","Name":"nebula-primary-rds-sg","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":true}],"name_prefix":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}},{"address":"module.s3.aws_iam_policy.replication","module_address":"module.s3","mode":"managed","type":"aws_iam_policy","name":"replication","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":null,"name":"nebula-s3-replication-policy","path":"/","tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"name_prefix":true,"policy":true,"policy_id":true,"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"module.s3.aws_iam_role.replication","module_address":"module.s3","mode":"managed","type":"aws_iam_role","name":"replication","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"s3.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"nebula-s3-replication-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"role_last_used":true,"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"role_last_used":[],"tags_all":{}}}},{"address":"module.s3.aws_iam_role_policy_attachment.replication","module_address":"module.s3","mode":"managed","type":"aws_iam_role_policy_attachment","name":"replication","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"role":"nebula-s3-replication-role"},"after_unknown":{"id":true,"policy_arn":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.s3.aws_s3_bucket.nebula_dr_bucket","module_address":"module.s3","mode":"managed","type":"aws_s3_bucket","name":"nebula_dr_bucket","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"force_destroy":false,"tags":null,"tags_all":{"DR":"true","Environment":"primary-dr","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"acceleration_status":true,"acl":true,"arn":true,"bucket":true,"bucket_domain_name":true,"bucket_prefix":true,"bucket_regional_domain_name":true,"cors_rule":true,"grant":true,"hosted_zone_id":true,"id":true,"lifecycle_rule":true,"logging":true,"object_lock_configuration":true,"object_lock_enabled":true,"policy":true,"region":true,"replication_configuration":true,"request_payer":true,"server_side_encryption_configuration":true,"tags_all":{},"versioning":true,"website":true,"website_domain":true,"website_endpoint":true},"before_sensitive":false,"after_sensitive":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}}},{"address":"module.s3.aws_s3_bucket.nebula_primary_bucket","module_address":"module.s3","mode":"managed","type":"aws_s3_bucket","name":"nebula_primary_bucket","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"force_destroy":false,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"acceleration_status":true,"acl":true,"arn":true,"bucket":true,"bucket_domain_name":true,"bucket_prefix":true,"bucket_regional_domain_name":true,"cors_rule":true,"grant":true,"hosted_zone_id":true,"id":true,"lifecycle_rule":true,"logging":true,"object_lock_configuration":true,"object_lock_enabled":true,"policy":true,"region":true,"replication_configuration":true,"request_payer":true,"server_side_encryption_configuration":true,"tags_all":{},"versioning":true,"website":true,"website_domain":true,"website_endpoint":true},"before_sensitive":false,"after_sensitive":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}}},{"address":"module.s3.aws_s3_bucket_lifecycle_configuration.nebula_bucket_lifecycle","module_address":"module.s3","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"nebula_bucket_lifecycle","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":365}],"filter":[],"id":"archive_old_objects","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":null,"status":"Enabled","transition":[{"date":"","days":180,"storage_class":"GLACIER"},{"date":"","days":90,"storage_class":"STANDARD_IA"}]}]},"after_unknown":{"bucket":true,"id":true,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"expired_object_delete_marker":true}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[{},{}]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[{},{}]}]}}},{"address":"module.s3.aws_s3_bucket_lifecycle_configuration.nebula_dr_bucket_lifecycle","module_address":"module.s3","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"nebula_dr_bucket_lifecycle","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":365}],"filter":[],"id":"archive_old_objects","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":null,"status":"Enabled","transition":[{"date":"","days":180,"storage_class":"GLACIER"},{"date":"","days":90,"storage_class":"STANDARD_IA"}]}]},"after_unknown":{"bucket":true,"id":true,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"expired_object_delete_marker":true}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[{},{}]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[{},{}]}]}}},{"address":"module.s3.aws_s3_bucket_replication_configuration.nebula_crr","module_address":"module.s3","mode":"managed","type":"aws_s3_bucket_replication_configuration","name":"nebula_crr","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"rule":[{"delete_marker_replication":[],"destination":[{"access_control_translation":[],"account":null,"encryption_configuration":[],"metrics":[],"replication_time":[],"storage_class":"STANDARD"}],"existing_object_replication":[],"filter":[],"id":"full-bucket-replication","prefix":null,"priority":null,"source_selection_criteria":[],"status":"Enabled"}],"token":null},"after_unknown":{"bucket":true,"id":true,"role":true,"rule":[{"delete_marker_replication":[],"destination":[{"access_control_translation":[],"bucket":true,"encryption_configuration":[],"metrics":[],"replication_time":[]}],"existing_object_replication":[],"filter":[],"source_selection_criteria":[]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"delete_marker_replication":[],"destination":[{"access_control_translation":[],"encryption_configuration":[],"metrics":[],"replication_time":[]}],"existing_object_replication":[],"filter":[],"source_selection_criteria":[]}],"token":true}}},{"address":"module.s3.aws_s3_bucket_versioning.nebula_dr_version","module_address":"module.s3","mode":"managed","type":"aws_s3_bucket_versioning","name":"nebula_dr_version","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"after_unknown":{"bucket":true,"id":true,"versioning_configuration":[{"mfa_delete":true}]},"before_sensitive":false,"after_sensitive":{"versioning_configuration":[{}]}}},{"address":"module.s3.aws_s3_bucket_versioning.nebula_primary_version","module_address":"module.s3","mode":"managed","type":"aws_s3_bucket_versioning","name":"nebula_primary_version","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"after_unknown":{"bucket":true,"id":true,"versioning_configuration":[{"mfa_delete":true}]},"before_sensitive":false,"after_sensitive":{"versioning_configuration":[{}]}}},{"address":"module.s3.random_id.bucket_suffix","module_address":"module.s3","mode":"managed","type":"random_id","name":"bucket_suffix","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["create"],"before":null,"after":{"byte_length":4,"keepers":null,"prefix":null},"after_unknown":{"b64_std":true,"b64_url":true,"dec":true,"hex":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ssm.aws_ssm_parameter.database_config","module_address":"module.ssm","mode":"managed","type":"aws_ssm_parameter","name":"database_config","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"allowed_pattern":null,"description":"Database configuration","name":"/nebula/primary/database","overwrite":null,"tags":null,"tags_all":{"Environment":"primary","Project":"nebula","Terraform":"true"},"type":"SecureString"},"after_unknown":{"arn":true,"data_type":true,"id":true,"insecure_value":true,"key_id":true,"tags_all":{},"tier":true,"value":true,"version":true},"before_sensitive":false,"after_sensitive":{"tags_all":{},"value":true}}},{"address":"module.vpc.aws_internet_gateway.nebula_igw","module_address":"module.vpc","mode":"managed","type":"aws_internet_gateway","name":"nebula_igw","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Environment":"primary","Name":"nebula-primary-igw","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-igw","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_route_table.nebula_private_rt","module_address":"module.vpc","mode":"managed","type":"aws_route_table","name":"nebula_private_rt","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Environment":"primary","Name":"nebula-primary-private-rt","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-private-rt","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_route_table.nebula_public_rt","module_address":"module.vpc","mode":"managed","type":"aws_route_table","name":"nebula_public_rt","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"route":[{"carrier_gateway_id":"","cidr_block":"0.0.0.0/0","core_network_arn":"","destination_prefix_list_id":"","egress_only_gateway_id":"","instance_id":"","ipv6_cidr_block":"","local_gateway_id":"","nat_gateway_id":"","network_interface_id":"","transit_gateway_id":"","vpc_endpoint_id":"","vpc_peering_connection_id":""}],"tags":{"Environment":"primary","Name":"nebula-primary-public-rt","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-public-rt","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":[{"gateway_id":true}],"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[{}],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_route_table_association.nebula_private_rt_assoc[0]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"nebula_private_rt_assoc","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.nebula_private_rt_assoc[1]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"nebula_private_rt_assoc","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.nebula_public_rt_assoc[0]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"nebula_public_rt_assoc","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.nebula_public_rt_assoc[1]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"nebula_public_rt_assoc","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_subnet.nebula_private_subnet[0]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"nebula_private_subnet","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1a","cidr_block":"10.0.3.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-private-1","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-private-1","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.nebula_private_subnet[1]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"nebula_private_subnet","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1b","cidr_block":"10.0.4.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-private-2","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-private-2","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.nebula_public_subnet[0]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"nebula_public_subnet","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1a","cidr_block":"10.0.1.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-public-1","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-public-1","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.nebula_public_subnet[1]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"nebula_public_subnet","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"eu-west-1b","cidr_block":"10.0.2.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Environment":"primary","Name":"nebula-primary-public-2","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-public-2","Project":"nebula","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_vpc.nebula_vpc","module_address":"module.vpc","mode":"managed","type":"aws_vpc","name":"nebula_vpc","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_generated_ipv6_cidr_block":null,"cidr_block":"10.0.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","ipv4_ipam_pool_id":null,"ipv4_netmask_length":null,"ipv6_ipam_pool_id":null,"ipv6_netmask_length":null,"tags":{"Environment":"primary","Name":"nebula-primary-vpc","Project":"nebula"},"tags_all":{"Environment":"primary","Name":"nebula-primary-vpc","Project":"nebula","Terraform":"true"}},"after_unknown":{"arn":true,"default_network_acl_id":true,"default_route_table_id":true,"default_security_group_id":true,"dhcp_options_id":true,"enable_classiclink":true,"enable_classiclink_dns_support":true,"enable_network_address_usage_metrics":true,"id":true,"ipv6_association_id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_network_border_group":true,"main_route_table_id":true,"owner_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}}],"output_changes":{"database_config_parameter_name":{"actions":["create"],"before":null,"after":"/nebula/primary/database","after_unknown":false,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.11.3","values":{"outputs":{"database_config_parameter_name":{"sensitive":false,"value":"/nebula/primary/database","type":"string"}},"root_module":{"child_modules":[{"resources":[{"address":"module.ec2.data.aws_ami.ubuntu_22_04","mode":"data","type":"aws_ami","name":"ubuntu_22_04","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"architecture":"x86_64","arn":"arn:aws:ec2:eu-west-1::image/ami-01c7096235204c7be","block_device_mappings":[{"device_name":"/dev/sda1","ebs":{"delete_on_termination":"true","encrypted":"false","iops":"0","snapshot_id":"snap-0952c24609c163256","throughput":"0","volume_size":"8","volume_type":"gp2"},"no_device":"","virtual_name":""},{"device_name":"/dev/sdb","ebs":{},"no_device":"","virtual_name":"ephemeral0"},{"device_name":"/dev/sdc","ebs":{},"no_device":"","virtual_name":"ephemeral1"}],"boot_mode":"uefi-preferred","creation_date":"2025-03-27T06:51:40.000Z","deprecation_time":"2027-03-27T06:51:40.000Z","description":"Canonical, Ubuntu, 22.04, amd64 jammy image","ena_support":true,"executable_users":null,"filter":[{"name":"name","values":["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]},{"name":"virtualization-type","values":["hvm"]}],"hypervisor":"xen","id":"ami-01c7096235204c7be","image_id":"ami-01c7096235204c7be","image_location":"amazon/ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-20250327","image_owner_alias":"amazon","image_type":"machine","imds_support":"","include_deprecated":false,"kernel_id":"","most_recent":true,"name":"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-20250327","name_regex":null,"owner_id":"099720109477","owners":["099720109477"],"platform":"","platform_details":"Linux/UNIX","product_codes":[],"public":true,"ramdisk_id":"","root_device_name":"/dev/sda1","root_device_type":"ebs","root_snapshot_id":"snap-0952c24609c163256","sriov_net_support":"simple","state":"available","state_reason":{"code":"UNSET","message":"UNSET"},"tags":{},"timeouts":null,"tpm_support":"","usage_operation":"RunInstances","virtualization_type":"hvm"},"sensitive_values":{"block_device_mappings":[{"ebs":{}},{"ebs":{}},{"ebs":{}}],"filter":[{"values":[false]},{"values":[false]}],"owners":[false],"product_codes":[],"state_reason":{},"tags":{}}},{"address":"module.ec2.data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"account_id":"202533544511","arn":"arn:aws:iam::202533544511:user/lampStack-iam12","id":"202533544511","user_id":"AIDAS6J7QUI74SHTJIKGQ"},"sensitive_values":{}}],"address":"module.ec2"}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","version_constraint":"~\u003e 4.0","expressions":{"default_tags":[{"tags":{"references":["var.project_name","var.environment_name"]}}],"region":{"references":["var.primary_region"]}}},"aws.dr_region":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","alias":"dr_region","version_constraint":"~\u003e 4.0","expressions":{"default_tags":[{"tags":{"references":["var.project_name","var.environment_name"]}}],"region":{"references":["var.dr_region"]}}},"module.s3:random":{"name":"random","full_name":"registry.terraform.io/hashicorp/random","module_address":"module.s3"}},"root_module":{"outputs":{"database_config_parameter_name":{"expression":{"references":["module.ssm.database_config_parameter_name","module.ssm"]}}},"module_calls":{"ec2":{"source":"../../modules/ec2","expressions":{"asg_max_size":{"references":["var.asg_max_size"]},"db_password":{"references":["var.db_password"]},"dr_region":{"references":["var.dr_region"]},"enable_dr_pilot_light":{"constant_value":false},"enable_ec2":{"constant_value":true},"environment_name":{"references":["var.environment_name"]},"instance_type":{"references":["var.instance_type"]},"key_pair_name":{"references":["var.key_pair_name"]},"project_name":{"references":["var.project_name"]},"region":{"references":["var.primary_region"]},"subnet_id":{"references":["module.vpc.private_subnet_ids[0]","module.vpc.private_subnet_ids","module.vpc"]},"subnet_ids":{"references":["module.vpc.private_subnet_ids","module.vpc"]},"tags":{"references":["var.tags"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"aws_ami_id":{"expression":{"references":["var.enable_ec2","aws_ami_from_instance.primary_ami[0].id","aws_ami_from_instance.primary_ami[0]","aws_ami_from_instance.primary_ami"]}},"ec2_security_group_id":{"expression":{"references":["aws_security_group.ec2_sg.id","aws_security_group.ec2_sg"]}},"instance_id":{"expression":{"references":["var.enable_ec2","aws_instance.nebula_primary_instance[0].id","aws_instance.nebula_primary_instance[0]","aws_instance.nebula_primary_instance"]},"description":"ID of the EC2 instance"},"instance_private_ip":{"expression":{"references":["var.enable_ec2","aws_instance.nebula_primary_instance[0].private_ip","aws_instance.nebula_primary_instance[0]","aws_instance.nebula_primary_instance"]},"description":"Private IP of the EC2 instance"},"instance_public_ip":{"expression":{"references":["var.enable_ec2","aws_instance.nebula_primary_instance[0].public_ip","aws_instance.nebula_primary_instance[0]","aws_instance.nebula_primary_instance"]},"description":"Public IP of the EC2 instance"},"security_group_id":{"expression":{"references":["aws_security_group.ec2_sg.id","aws_security_group.ec2_sg"]},"description":"ID of the instance security group"}},"resources":[{"address":"aws_ami_copy.dr_ami","mode":"managed","type":"aws_ami_copy","name":"dr_ami","provider_config_key":"aws","expressions":{"description":{"constant_value":"DR copy of primary instance AMI"},"encrypted":{"constant_value":true},"name":{"references":["var.project_name"]},"source_ami_id":{"references":["aws_ami_from_instance.primary_ami[0].id","aws_ami_from_instance.primary_ami[0]","aws_ami_from_instance.primary_ami"]},"source_ami_region":{"references":["var.region"]},"tags":{"references":["var.tags","var.project_name","var.environment_name","var.dr_region","var.project_name"]}},"schema_version":0,"count_expression":{"references":["var.enable_ec2"]}},{"address":"aws_ami_from_instance.primary_ami","mode":"managed","type":"aws_ami_from_instance","name":"primary_ami","provider_config_key":"aws","expressions":{"description":{"constant_value":"Daily AMI backup of primary instance for DR purposes"},"name":{"references":["var.project_name"]},"source_instance_id":{"references":["aws_instance.nebula_primary_instance[0].id","aws_instance.nebula_primary_instance[0]","aws_instance.nebula_primary_instance"]},"tags":{"references":["var.tags","var.project_name","var.environment_name","var.region","var.project_name"]}},"schema_version":0,"count_expression":{"references":["var.enable_ec2"]}},{"address":"aws_autoscaling_group.dr_asg","mode":"managed","type":"aws_autoscaling_group","name":"dr_asg","provider_config_key":"aws","expressions":{"desired_capacity":{"constant_value":0},"health_check_grace_period":{"constant_value":300},"health_check_type":{"constant_value":"EC2"},"instance_refresh":[{"preferences":[{"min_healthy_percentage":{"constant_value":90}}],"strategy":{"constant_value":"Rolling"}}],"launch_template":[{"id":{"references":["aws_launch_template.dr_launch_template[0].id","aws_launch_template.dr_launch_template[0]","aws_launch_template.dr_launch_template"]},"version":{"constant_value":"$Latest"}}],"max_size":{"references":["var.asg_max_size"]},"min_size":{"constant_value":0},"name":{"references":["var.project_name","var.environment_name"]},"tag":[{"key":{"constant_value":"Name"},"propagate_at_launch":{"constant_value":true},"value":{"references":["var.project_name","var.environment_name"]}},{"key":{"constant_value":"DR"},"propagate_at_launch":{"constant_value":true},"value":{"constant_value":"true"}}],"vpc_zone_identifier":{"references":["var.subnet_ids"]}},"schema_version":0,"count_expression":{"references":["var.enable_dr_pilot_light"]}},{"address":"aws_cloudwatch_event_rule.daily_ami","mode":"managed","type":"aws_cloudwatch_event_rule","name":"daily_ami","provider_config_key":"aws","expressions":{"description":{"constant_value":"Trigger daily AMI creation"},"name":{"references":["var.project_name","var.environment_name"]},"schedule_expression":{"constant_value":"cron(0 1 * * ? *)"},"tags":{"references":["var.tags","var.project_name"]}},"schema_version":0,"count_expression":{"references":["var.enable_ec2"]}},{"address":"aws_cloudwatch_event_target.ssm_automation","mode":"managed","type":"aws_cloudwatch_event_target","name":"ssm_automation","provider_config_key":"aws","expressions":{"arn":{"references":["var.region","data.aws_caller_identity.current.account_id","data.aws_caller_identity.current","aws_ssm_document.create_ami.name","aws_ssm_document.create_ami"]},"input":{"references":["aws_instance.nebula_primary_instance[0].id","aws_instance.nebula_primary_instance[0]","aws_instance.nebula_primary_instance","var.project_name","var.region","var.dr_region"]},"role_arn":{"references":["aws_iam_role.eventbridge_role[0].arn","aws_iam_role.eventbridge_role[0]","aws_iam_role.eventbridge_role"]},"rule":{"references":["aws_cloudwatch_event_rule.daily_ami[0].name","aws_cloudwatch_event_rule.daily_ami[0]","aws_cloudwatch_event_rule.daily_ami"]},"target_id":{"constant_value":"SSMAutomation"}},"schema_version":1,"count_expression":{"references":["var.enable_ec2"]}},{"address":"aws_iam_instance_profile.ec2_profile","mode":"managed","type":"aws_iam_instance_profile","name":"ec2_profile","provider_config_key":"aws","expressions":{"name":{"references":["var.project_name","var.environment_name"]},"role":{"references":["aws_iam_role.ec2_role.name","aws_iam_role.ec2_role"]}},"schema_version":0},{"address":"aws_iam_role.ec2_role","mode":"managed","type":"aws_iam_role","name":"ec2_role","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name":{"references":["var.project_name","var.environment_name"]}},"schema_version":0},{"address":"aws_iam_role.eventbridge_role","mode":"managed","type":"aws_iam_role","name":"eventbridge_role","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name":{"references":["var.project_name","var.environment_name"]}},"schema_version":0,"count_expression":{"references":["var.enable_ec2"]}},{"address":"aws_iam_role_policy.ami_policy","mode":"managed","type":"aws_iam_role_policy","name":"ami_policy","provider_config_key":"aws","expressions":{"name":{"references":["var.project_name","var.environment_name"]},"policy":{},"role":{"references":["aws_iam_role.ec2_role.id","aws_iam_role.ec2_role"]}},"schema_version":0},{"address":"aws_iam_role_policy.cloudwatch_policy","mode":"managed","type":"aws_iam_role_policy","name":"cloudwatch_policy","provider_config_key":"aws","expressions":{"name":{"references":["var.project_name","var.environment_name"]},"policy":{},"role":{"references":["aws_iam_role.ec2_role.id","aws_iam_role.ec2_role"]}},"schema_version":0},{"address":"aws_iam_role_policy.eventbridge_policy","mode":"managed","type":"aws_iam_role_policy","name":"eventbridge_policy","provider_config_key":"aws","expressions":{"name":{"references":["var.project_name","var.environment_name"]},"policy":{"references":["var.region","data.aws_caller_identity.current.account_id","data.aws_caller_identity.current","aws_ssm_document.create_ami.name","aws_ssm_document.create_ami"]},"role":{"references":["aws_iam_role.eventbridge_role[0].id","aws_iam_role.eventbridge_role[0]","aws_iam_role.eventbridge_role"]}},"schema_version":0,"count_expression":{"references":["var.enable_ec2"]}},{"address":"aws_iam_role_policy.ssm_policy","mode":"managed","type":"aws_iam_role_policy","name":"ssm_policy","provider_config_key":"aws","expressions":{"name":{"references":["var.project_name","var.environment_name"]},"policy":{"references":["var.region","data.aws_caller_identity.current.account_id","data.aws_caller_identity.current","var.project_name","var.environment_name"]},"role":{"references":["aws_iam_role.ec2_role.id","aws_iam_role.ec2_role"]}},"schema_version":0},{"address":"aws_instance.nebula_primary_instance","mode":"managed","type":"aws_instance","name":"nebula_primary_instance","provider_config_key":"aws","expressions":{"ami":{"references":["data.aws_ami.ubuntu_22_04.id","data.aws_ami.ubuntu_22_04"]},"iam_instance_profile":{"references":["aws_iam_instance_profile.ec2_profile.name","aws_iam_instance_profile.ec2_profile"]},"instance_type":{"references":["var.instance_type"]},"key_name":{"references":["var.key_pair_name"]},"subnet_id":{"references":["var.subnet_id"]},"tags":{"references":["var.tags","var.project_name","var.environment_name","var.environment_name","var.region","var.project_name"]},"user_data":{"references":["path.module","var.project_name","var.environment_name","var.db_password"]},"vpc_security_group_ids":{"references":["aws_security_group.ec2_sg.id","aws_security_group.ec2_sg"]}},"schema_version":1,"count_expression":{"references":["var.enable_ec2"]}},{"address":"aws_launch_template.dr_launch_template","mode":"managed","type":"aws_launch_template","name":"dr_launch_template","provider_config_key":"aws","expressions":{"image_id":{"references":["var.enable_dr_pilot_light","data.aws_ami.latest_dr_ami","data.aws_ami.latest_dr_ami[0].id","data.aws_ami.latest_dr_ami[0]","data.aws_ami.latest_dr_ami","data.aws_ami.ubuntu_22_04.id","data.aws_ami.ubuntu_22_04"]},"instance_type":{"references":["var.instance_type"]},"name_prefix":{"references":["var.project_name","var.environment_name"]},"network_interfaces":[{"associate_public_ip_address":{"constant_value":false},"security_groups":{"references":["aws_security_group.ec2_sg.id","aws_security_group.ec2_sg"]}}],"tag_specifications":[{"resource_type":{"constant_value":"instance"},"tags":{"references":["var.tags","var.project_name","var.environment_name"]}}],"user_data":{"references":["path.module","var.project_name","var.environment_name","var.db_password"]}},"schema_version":0,"count_expression":{"references":["var.enable_dr_pilot_light"]}},{"address":"aws_security_group.ec2_sg","mode":"managed","type":"aws_security_group","name":"ec2_sg","provider_config_key":"aws","expressions":{"description":{"constant_value":"Security group for EC2 instances"},"egress":{"constant_value":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_groups":null,"self":null,"to_port":0}]},"ingress":{"constant_value":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow SSH access","from_port":22,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_groups":null,"self":null,"to_port":22},{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTP access","from_port":80,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_groups":null,"self":null,"to_port":80}]},"name":{"references":["var.project_name","var.environment_name"]},"tags":{"references":["var.tags","var.project_name","var.environment_name"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1},{"address":"aws_ssm_document.create_ami","mode":"managed","type":"aws_ssm_document","name":"create_ami","provider_config_key":"aws","expressions":{"content":{"references":["var.environment_name","var.project_name"]},"document_format":{"constant_value":"YAML"},"document_type":{"constant_value":"Automation"},"name":{"references":["var.project_name","var.environment_name"]}},"schema_version":0},{"address":"data.aws_ami.latest_dr_ami","mode":"data","type":"aws_ami","name":"latest_dr_ami","provider_config_key":"aws","expressions":{"filter":[{"name":{"constant_value":"name"},"values":{"references":["var.project_name"]}},{"name":{"constant_value":"tag:DR"},"values":{"constant_value":["true"]}}],"most_recent":{"constant_value":true},"owners":{"constant_value":["self"]}},"schema_version":0,"count_expression":{"references":["var.enable_dr_pilot_light"]}},{"address":"data.aws_ami.ubuntu_22_04","mode":"data","type":"aws_ami","name":"ubuntu_22_04","provider_config_key":"aws","expressions":{"filter":[{"name":{"constant_value":"name"},"values":{"constant_value":["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]}},{"name":{"constant_value":"virtualization-type"},"values":{"constant_value":["hvm"]}}],"most_recent":{"constant_value":true},"owners":{"constant_value":["099720109477"]}},"schema_version":0},{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_config_key":"aws","schema_version":0}],"variables":{"asg_max_size":{"default":3,"description":"Maximum size of the Auto Scaling Group"},"db_password":{"description":"Password for MySQL root user","sensitive":true},"dr_region":{},"enable_dr_pilot_light":{"default":false,"description":"Whether to create DR ASG resources"},"enable_ec2":{"default":true,"description":"Whether to create EC2 resources"},"environment_name":{},"instance_type":{},"key_pair_name":{},"project_name":{},"region":{},"subnet_id":{},"subnet_ids":{"description":"List of subnet IDs for the ASG"},"tags":{},"vpc_id":{}}}},"rds":{"source":"../../modules/rds","expressions":{"allocated_storage":{"references":["var.allocated_storage"]},"db_engine":{"references":["var.db_engine"]},"db_password":{"references":["var.db_password"]},"db_username":{"references":["var.db_username"]},"ec2_security_group_id":{"references":["module.ec2.security_group_id","module.ec2"]},"engine_version":{"references":["var.engine_version"]},"environment_name":{"references":["var.environment_name"]},"instance_class":{"references":["var.db_instance_class"]},"is_read_replica":{"constant_value":false},"multi_az":{"references":["var.multi_az"]},"project_name":{"references":["var.project_name"]},"region":{"references":["var.primary_region"]},"storage_encrypted":{"references":["var.enable_encryption"]},"subnet_ids":{"references":["module.vpc.private_subnet_ids","module.vpc"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"db_instance_id":{"expression":{"references":["var.environment_name","aws_db_instance.nebula_primary_db_instance[0].id","aws_db_instance.nebula_primary_db_instance[0]","aws_db_instance.nebula_primary_db_instance"]},"description":"The instance ID of the RDS instance"},"primary_db_arn":{"expression":{"references":["var.environment_name","aws_db_instance.nebula_primary_db_instance[0].arn","aws_db_instance.nebula_primary_db_instance[0]","aws_db_instance.nebula_primary_db_instance"]},"description":"The ARN of the primary RDS instance"},"primary_db_endpoint":{"expression":{"references":["var.environment_name","aws_db_instance.nebula_primary_db_instance[0].endpoint","aws_db_instance.nebula_primary_db_instance[0]","aws_db_instance.nebula_primary_db_instance"]},"description":"The connection endpoint for the primary RDS instance"},"rds_security_group_id":{"expression":{"references":["aws_security_group.rds_sg.id","aws_security_group.rds_sg"]}}},"resources":[{"address":"aws_db_instance.nebula_primary_db_instance","mode":"managed","type":"aws_db_instance","name":"nebula_primary_db_instance","provider_config_key":"aws","expressions":{"allocated_storage":{"references":["var.allocated_storage"]},"db_subnet_group_name":{"references":["aws_db_subnet_group.nebula_subnet_group.name","aws_db_subnet_group.nebula_subnet_group"]},"engine":{"references":["var.db_engine"]},"engine_version":{"references":["var.engine_version"]},"identifier":{"references":["var.project_name"]},"instance_class":{"references":["var.instance_class"]},"multi_az":{"references":["var.multi_az"]},"password":{"references":["var.db_password"]},"publicly_accessible":{"references":["var.publicly_accessible"]},"skip_final_snapshot":{"references":["var.skip_final_snapshot"]},"storage_encrypted":{"references":["var.storage_encrypted"]},"tags":{"references":["var.tags","var.project_name","var.environment_name","var.region","var.project_name"]},"username":{"references":["var.db_username"]},"vpc_security_group_ids":{"references":["aws_security_group.rds_sg.id","aws_security_group.rds_sg"]}},"schema_version":1,"count_expression":{"references":["var.environment_name"]}},{"address":"aws_db_instance.nebula_read_replica","mode":"managed","type":"aws_db_instance","name":"nebula_read_replica","provider_config_key":"aws","expressions":{"auto_minor_version_upgrade":{"constant_value":true},"db_subnet_group_name":{"references":["aws_db_subnet_group.nebula_subnet_group.name","aws_db_subnet_group.nebula_subnet_group"]},"identifier":{"references":["var.project_name"]},"instance_class":{"references":["var.instance_class"]},"publicly_accessible":{"references":["var.publicly_accessible"]},"replicate_source_db":{"references":["aws_db_instance.nebula_primary_db_instance[0].arn","aws_db_instance.nebula_primary_db_instance[0]","aws_db_instance.nebula_primary_db_instance"]},"skip_final_snapshot":{"references":["var.skip_final_snapshot"]},"storage_encrypted":{"references":["var.storage_encrypted"]},"tags":{"references":["var.tags","var.project_name","var.environment_name","var.region","var.project_name"]},"vpc_security_group_ids":{"references":["aws_security_group.rds_sg.id","aws_security_group.rds_sg"]}},"schema_version":1,"count_expression":{"references":["var.environment_name","var.is_read_replica"]}},{"address":"aws_db_instance_automated_backups_replication.cross_region","mode":"managed","type":"aws_db_instance_automated_backups_replication","name":"cross_region","provider_config_key":"aws","expressions":{"kms_key_id":{"references":["aws_kms_key.nebula_dr_backups[0].arn","aws_kms_key.nebula_dr_backups[0]","aws_kms_key.nebula_dr_backups"]},"retention_period":{"references":["var.retention_period"]},"source_db_instance_arn":{"references":["aws_db_instance.nebula_primary_db_instance[0].arn","aws_db_instance.nebula_primary_db_instance[0]","aws_db_instance.nebula_primary_db_instance"]}},"schema_version":0,"count_expression":{"references":["var.environment_name","var.enable_cross_region_backup"]}},{"address":"aws_db_subnet_group.nebula_subnet_group","mode":"managed","type":"aws_db_subnet_group","name":"nebula_subnet_group","provider_config_key":"aws","expressions":{"description":{"references":["var.environment_name"]},"name":{"references":["var.environment_name"]},"subnet_ids":{"references":["var.subnet_ids"]},"tags":{"references":["var.environment_name","var.environment_name","var.tags"]}},"schema_version":0},{"address":"aws_kms_key.nebula_dr_backups","mode":"managed","type":"aws_kms_key","name":"nebula_dr_backups","provider_config_key":"aws","expressions":{"deletion_window_in_days":{"references":["var.deletion_window_in_days"]},"description":{"constant_value":"KMS key for DR backups"},"enable_key_rotation":{"references":["var.enable_key_rotation"]}},"schema_version":0,"count_expression":{"references":["var.environment_name","var.enable_cross_region_backup"]}},{"address":"aws_security_group.rds_sg","mode":"managed","type":"aws_security_group","name":"rds_sg","provider_config_key":"aws","expressions":{"description":{"constant_value":"Security group for RDS instances"},"egress":{"constant_value":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_groups":null,"self":null,"to_port":0}]},"ingress":{"references":["var.ec2_security_group_id"]},"name":{"references":["var.project_name","var.environment_name"]},"tags":{"references":["var.tags","var.project_name","var.environment_name"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1}],"variables":{"allocated_storage":{"default":20},"db_engine":{"default":"postgres"},"db_password":{"default":"MustBe12Char!"},"db_username":{"default":"admin"},"deletion_window_in_days":{"default":10},"ec2_security_group_id":{},"enable_cross_region_backup":{"default":false},"enable_key_rotation":{"default":true},"engine_version":{"default":"14.5"},"environment_name":{},"instance_class":{"default":"db.t4g.micro"},"is_read_replica":{},"multi_az":{"default":false},"project_name":{"default":"nebula"},"publicly_accessible":{"default":false},"region":{},"retention_period":{"default":7},"skip_final_snapshot":{"default":true},"storage_encrypted":{"default":true},"subnet_ids":{},"tags":{"default":{},"description":"A map of tags to apply to the resource"},"vpc_id":{}}}},"s3":{"source":"../../modules/s3","expressions":{"environment_name":{"references":["var.environment_name"]},"expiration_days":{"references":["var.expiration_days"]},"glacier_days":{"references":["var.glacier_days"]},"ia_days":{"references":["var.ia_days"]},"project_name":{"references":["var.project_name"]},"region":{"references":["var.primary_region"]}},"module":{"outputs":{"dr_bucket_arn":{"expression":{"references":["aws_s3_bucket.nebula_dr_bucket.arn","aws_s3_bucket.nebula_dr_bucket"]},"description":"The ARN of the DR S3 bucket"},"dr_bucket_id":{"expression":{"references":["aws_s3_bucket.nebula_dr_bucket.id","aws_s3_bucket.nebula_dr_bucket"]},"description":"The name of the DR S3 bucket"},"primary_bucket_arn":{"expression":{"references":["aws_s3_bucket.nebula_primary_bucket.arn","aws_s3_bucket.nebula_primary_bucket"]},"description":"The ARN of the primary S3 bucket"},"primary_bucket_id":{"expression":{"references":["aws_s3_bucket.nebula_primary_bucket.id","aws_s3_bucket.nebula_primary_bucket"]},"description":"The name of the primary S3 bucket"}},"resources":[{"address":"aws_iam_policy.replication","mode":"managed","type":"aws_iam_policy","name":"replication","provider_config_key":"aws","expressions":{"name":{"references":["var.project_name"]},"policy":{"references":["aws_s3_bucket.nebula_primary_bucket.arn","aws_s3_bucket.nebula_primary_bucket","aws_s3_bucket.nebula_primary_bucket.arn","aws_s3_bucket.nebula_primary_bucket","aws_s3_bucket.nebula_dr_bucket.arn","aws_s3_bucket.nebula_dr_bucket"]}},"schema_version":0},{"address":"aws_iam_role.replication","mode":"managed","type":"aws_iam_role","name":"replication","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name":{"references":["var.project_name"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.replication","mode":"managed","type":"aws_iam_role_policy_attachment","name":"replication","provider_config_key":"aws","expressions":{"policy_arn":{"references":["aws_iam_policy.replication.arn","aws_iam_policy.replication"]},"role":{"references":["aws_iam_role.replication.name","aws_iam_role.replication"]}},"schema_version":0},{"address":"aws_s3_bucket.nebula_dr_bucket","mode":"managed","type":"aws_s3_bucket","name":"nebula_dr_bucket","provider_config_key":"aws.dr_region","expressions":{"bucket":{"references":["var.project_name","random_id.bucket_suffix.hex","random_id.bucket_suffix"]}},"schema_version":0},{"address":"aws_s3_bucket.nebula_primary_bucket","mode":"managed","type":"aws_s3_bucket","name":"nebula_primary_bucket","provider_config_key":"aws","expressions":{"bucket":{"references":["var.project_name","random_id.bucket_suffix.hex","random_id.bucket_suffix"]}},"schema_version":0},{"address":"aws_s3_bucket_lifecycle_configuration.nebula_bucket_lifecycle","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"nebula_bucket_lifecycle","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.nebula_primary_bucket.id","aws_s3_bucket.nebula_primary_bucket"]},"rule":[{"expiration":[{"days":{"references":["var.expiration_days"]}}],"id":{"constant_value":"archive_old_objects"},"status":{"constant_value":"Enabled"},"transition":[{"days":{"references":["var.ia_days"]},"storage_class":{"constant_value":"STANDARD_IA"}},{"days":{"references":["var.glacier_days"]},"storage_class":{"constant_value":"GLACIER"}}]}]},"schema_version":0},{"address":"aws_s3_bucket_lifecycle_configuration.nebula_dr_bucket_lifecycle","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"nebula_dr_bucket_lifecycle","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.nebula_dr_bucket.id","aws_s3_bucket.nebula_dr_bucket"]},"rule":[{"expiration":[{"days":{"references":["var.expiration_days"]}}],"id":{"constant_value":"archive_old_objects"},"status":{"constant_value":"Enabled"},"transition":[{"days":{"references":["var.ia_days"]},"storage_class":{"constant_value":"STANDARD_IA"}},{"days":{"references":["var.glacier_days"]},"storage_class":{"constant_value":"GLACIER"}}]}]},"schema_version":0},{"address":"aws_s3_bucket_replication_configuration.nebula_crr","mode":"managed","type":"aws_s3_bucket_replication_configuration","name":"nebula_crr","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.nebula_primary_bucket.id","aws_s3_bucket.nebula_primary_bucket"]},"role":{"references":["aws_iam_role.replication.arn","aws_iam_role.replication"]},"rule":[{"destination":[{"bucket":{"references":["aws_s3_bucket.nebula_dr_bucket.arn","aws_s3_bucket.nebula_dr_bucket"]},"storage_class":{"constant_value":"STANDARD"}}],"id":{"constant_value":"full-bucket-replication"},"status":{"constant_value":"Enabled"}}]},"schema_version":0,"depends_on":["aws_s3_bucket_versioning.nebula_primary_version"]},{"address":"aws_s3_bucket_versioning.nebula_dr_version","mode":"managed","type":"aws_s3_bucket_versioning","name":"nebula_dr_version","provider_config_key":"aws.dr_region","expressions":{"bucket":{"references":["aws_s3_bucket.nebula_dr_bucket.id","aws_s3_bucket.nebula_dr_bucket"]},"versioning_configuration":[{"status":{"constant_value":"Enabled"}}]},"schema_version":0},{"address":"aws_s3_bucket_versioning.nebula_primary_version","mode":"managed","type":"aws_s3_bucket_versioning","name":"nebula_primary_version","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.nebula_primary_bucket.id","aws_s3_bucket.nebula_primary_bucket"]},"versioning_configuration":[{"status":{"constant_value":"Enabled"}}]},"schema_version":0},{"address":"random_id.bucket_suffix","mode":"managed","type":"random_id","name":"bucket_suffix","provider_config_key":"module.s3:random","expressions":{"byte_length":{"constant_value":4}},"schema_version":0}],"variables":{"environment_name":{},"expiration_days":{"default":365},"glacier_days":{"default":180},"ia_days":{"default":90},"project_name":{"default":"nebula"},"region":{},"tags":{"default":{},"description":"A map of tags to apply to resources"}}}},"ssm":{"source":"../../modules/ssm","expressions":{"db_endpoint":{"references":["module.rds.primary_db_endpoint","module.rds"]},"db_password":{"references":["var.db_password"]},"db_username":{"references":["var.db_username"]},"environment_name":{"references":["var.environment_name"]},"project_name":{"references":["var.project_name"]}},"module":{"outputs":{"database_config_parameter_arn":{"expression":{"references":["aws_ssm_parameter.database_config.arn","aws_ssm_parameter.database_config"]},"description":"The ARN of the SSM parameter storing database configuration"},"database_config_parameter_name":{"expression":{"references":["aws_ssm_parameter.database_config.name","aws_ssm_parameter.database_config"]},"description":"The name of the SSM parameter storing database configuration"},"database_config_version":{"expression":{"references":["aws_ssm_parameter.database_config.version","aws_ssm_parameter.database_config"]},"description":"The version of the SSM parameter"}},"resources":[{"address":"aws_ssm_parameter.database_config","mode":"managed","type":"aws_ssm_parameter","name":"database_config","provider_config_key":"aws","expressions":{"description":{"constant_value":"Database configuration"},"name":{"references":["var.project_name","var.environment_name"]},"type":{"constant_value":"SecureString"},"value":{"references":["var.db_username","var.db_password","var.db_endpoint"]}},"schema_version":0}],"variables":{"db_endpoint":{"description":"RDS instance endpoint"},"db_password":{"sensitive":true},"db_username":{},"environment_name":{},"project_name":{}}},"depends_on":["module.rds"]},"vpc":{"source":"../../modules/vpc","expressions":{"availability_zones":{"references":["var.availability_zones"]},"environment":{"references":["var.environment_name"]},"private_subnets":{"references":["var.private_subnets"]},"project_name":{"references":["var.project_name"]},"public_subnets":{"references":["var.public_subnets"]},"tags":{"references":["var.tags"]},"vpc_cidr":{"references":["var.vpc_cidr"]}},"module":{"outputs":{"igw_id":{"expression":{"references":["aws_internet_gateway.nebula_igw.id","aws_internet_gateway.nebula_igw"]},"description":"The ID of the Internet Gateway"},"private_subnet_ids":{"expression":{"references":["aws_subnet.nebula_private_subnet"]},"description":"List of private subnet IDs"},"public_subnet_ids":{"expression":{"references":["aws_subnet.nebula_public_subnet"]},"description":"List of public subnet IDs"},"vpc_cidr_block":{"expression":{"references":["aws_vpc.nebula_vpc.cidr_block","aws_vpc.nebula_vpc"]},"description":"The CIDR block of the VPC"},"vpc_id":{"expression":{"references":["aws_vpc.nebula_vpc.id","aws_vpc.nebula_vpc"]},"description":"The ID of the VPC"}},"resources":[{"address":"aws_internet_gateway.nebula_igw","mode":"managed","type":"aws_internet_gateway","name":"nebula_igw","provider_config_key":"aws","expressions":{"tags":{"references":["var.tags","var.project_name","var.environment"]},"vpc_id":{"references":["aws_vpc.nebula_vpc.id","aws_vpc.nebula_vpc"]}},"schema_version":0},{"address":"aws_route_table.nebula_private_rt","mode":"managed","type":"aws_route_table","name":"nebula_private_rt","provider_config_key":"aws","expressions":{"tags":{"references":["var.tags","var.project_name","var.environment"]},"vpc_id":{"references":["aws_vpc.nebula_vpc.id","aws_vpc.nebula_vpc"]}},"schema_version":0},{"address":"aws_route_table.nebula_public_rt","mode":"managed","type":"aws_route_table","name":"nebula_public_rt","provider_config_key":"aws","expressions":{"route":{"references":["aws_internet_gateway.nebula_igw.id","aws_internet_gateway.nebula_igw"]},"tags":{"references":["var.tags","var.project_name","var.environment"]},"vpc_id":{"references":["aws_vpc.nebula_vpc.id","aws_vpc.nebula_vpc"]}},"schema_version":0},{"address":"aws_route_table_association.nebula_private_rt_assoc","mode":"managed","type":"aws_route_table_association","name":"nebula_private_rt_assoc","provider_config_key":"aws","expressions":{"route_table_id":{"references":["aws_route_table.nebula_private_rt.id","aws_route_table.nebula_private_rt"]},"subnet_id":{"references":["aws_subnet.nebula_private_subnet","count.index"]}},"schema_version":0,"count_expression":{"constant_value":2}},{"address":"aws_route_table_association.nebula_public_rt_assoc","mode":"managed","type":"aws_route_table_association","name":"nebula_public_rt_assoc","provider_config_key":"aws","expressions":{"route_table_id":{"references":["aws_route_table.nebula_public_rt.id","aws_route_table.nebula_public_rt"]},"subnet_id":{"references":["aws_subnet.nebula_public_subnet","count.index"]}},"schema_version":0,"count_expression":{"constant_value":2}},{"address":"aws_subnet.nebula_private_subnet","mode":"managed","type":"aws_subnet","name":"nebula_private_subnet","provider_config_key":"aws","expressions":{"availability_zone":{"references":["var.availability_zones","count.index"]},"cidr_block":{"references":["var.private_subnets","count.index"]},"tags":{"references":["var.tags","var.project_name","var.environment","count.index"]},"vpc_id":{"references":["aws_vpc.nebula_vpc.id","aws_vpc.nebula_vpc"]}},"schema_version":1,"count_expression":{"constant_value":2}},{"address":"aws_subnet.nebula_public_subnet","mode":"managed","type":"aws_subnet","name":"nebula_public_subnet","provider_config_key":"aws","expressions":{"availability_zone":{"references":["var.availability_zones","count.index"]},"cidr_block":{"references":["var.public_subnets","count.index"]},"map_public_ip_on_launch":{"constant_value":true},"tags":{"references":["var.tags","var.project_name","var.environment","count.index"]},"vpc_id":{"references":["aws_vpc.nebula_vpc.id","aws_vpc.nebula_vpc"]}},"schema_version":1,"count_expression":{"constant_value":2}},{"address":"aws_vpc.nebula_vpc","mode":"managed","type":"aws_vpc","name":"nebula_vpc","provider_config_key":"aws","expressions":{"cidr_block":{"references":["var.vpc_cidr"]},"enable_dns_hostnames":{"constant_value":true},"enable_dns_support":{"constant_value":true},"tags":{"references":["var.tags","var.project_name","var.environment"]}},"schema_version":1}],"variables":{"availability_zones":{},"environment":{},"private_subnets":{},"project_name":{},"public_subnets":{},"tags":{},"vpc_cidr":{}}}}},"variables":{"allocated_storage":{},"asg_max_size":{},"availability_zones":{},"db_engine":{},"db_instance_class":{},"db_password":{},"db_username":{},"dr_region":{},"enable_encryption":{},"engine_version":{},"environment_name":{},"expiration_days":{},"glacier_days":{},"ia_days":{},"instance_type":{},"key_pair_name":{},"multi_az":{},"primary_region":{},"private_subnets":{},"project_name":{},"public_subnets":{},"tags":{"default":{}},"vpc_cidr":{}}}},"relevant_attributes":[{"resource":"module.s3.aws_s3_bucket.nebula_dr_bucket","attribute":["id"]},{"resource":"module.ssm.aws_ssm_parameter.database_config","attribute":["arn"]},{"resource":"module.ec2.aws_iam_instance_profile.ec2_profile","attribute":["name"]},{"resource":"module.rds.aws_db_subnet_group.nebula_subnet_group","attribute":["name"]},{"resource":"module.s3.aws_iam_role.replication","attribute":["arn"]},{"resource":"module.vpc.aws_subnet.nebula_private_subnet","attribute":[]},{"resource":"module.s3.aws_s3_bucket.nebula_dr_bucket","attribute":["arn"]},{"resource":"module.ec2.aws_ami_from_instance.primary_ami[0]","attribute":["id"]},{"resource":"module.ec2.aws_security_group.ec2_sg","attribute":["id"]},{"resource":"module.ec2.data.aws_caller_identity.current","attribute":["account_id"]},{"resource":"module.vpc.aws_route_table.nebula_public_rt","attribute":["id"]},{"resource":"module.ec2.aws_instance.nebula_primary_instance[0]","attribute":["id"]},{"resource":"module.vpc.aws_route_table.nebula_private_rt","attribute":["id"]},{"resource":"module.ec2.aws_iam_role.ec2_role","attribute":["id"]},{"resource":"module.rds.aws_db_instance.nebula_primary_db_instance[0]","attribute":["id"]},{"resource":"module.s3.aws_iam_role.replication","attribute":["name"]},{"resource":"module.ssm.aws_ssm_parameter.database_config","attribute":["version"]},{"resource":"module.rds.aws_db_instance.nebula_primary_db_instance[0]","attribute":["endpoint"]},{"resource":"module.ec2.aws_iam_role.eventbridge_role[0]","attribute":["arn"]},{"resource":"module.s3.aws_s3_bucket.nebula_primary_bucket","attribute":["arn"]},{"resource":"module.rds.aws_db_instance.nebula_primary_db_instance[0]","attribute":["arn"]},{"resource":"module.ec2.aws_cloudwatch_event_rule.daily_ami[0]","attribute":["name"]},{"resource":"module.s3.aws_s3_bucket.nebula_primary_bucket","attribute":["id"]},{"resource":"module.ec2.aws_iam_role.eventbridge_role[0]","attribute":["id"]},{"resource":"module.vpc.aws_subnet.nebula_public_subnet","attribute":[]},{"resource":"module.ec2.aws_iam_role.ec2_role","attribute":["name"]},{"resource":"module.ec2.aws_instance.nebula_primary_instance[0]","attribute":["private_ip"]},{"resource":"module.ec2.data.aws_ami.ubuntu_22_04","attribute":["id"]},{"resource":"module.ec2.aws_ssm_document.create_ami","attribute":["name"]},{"resource":"module.rds.aws_security_group.rds_sg","attribute":["id"]},{"resource":"module.vpc.aws_vpc.nebula_vpc","attribute":["id"]},{"resource":"module.s3.random_id.bucket_suffix","attribute":["hex"]},{"resource":"module.ssm.aws_ssm_parameter.database_config","attribute":["name"]},{"resource":"module.ec2.aws_instance.nebula_primary_instance[0]","attribute":["public_ip"]},{"resource":"module.s3.aws_iam_policy.replication","attribute":["arn"]},{"resource":"module.vpc.aws_internet_gateway.nebula_igw","attribute":["id"]},{"resource":"module.vpc.aws_vpc.nebula_vpc","attribute":["cidr_block"]}],"timestamp":"2025-04-17T15:30:22Z","applyable":true,"complete":true,"errored":false}
